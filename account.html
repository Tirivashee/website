<!DOCTYPE html>
<html lang="en">
<script>
  // Block admin users from accessing regular pages
  document.addEventListener('DOMContentLoaded', async () => {
    // Wait a bit for auth to load
    setTimeout(() => {
      if (window.authManager?.isAuthenticated() && window.authManager.isAdmin()) {
        alert('Admin users cannot access regular user pages. Redirecting to system dashboard.');
        window.location.href = 'system/system.html';
      }
    }, 500);
  });
</script>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>My Account - BALLYLIKE</title>
  
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/navigation.css">
  
  <style>
    body {
      padding-top: 80px;
      background: #fafafa;
    }

    .account-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-xl) var(--spacing-md);
    }

    .account-header {
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: var(--border);
    }

    .account-header h1 {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--spacing-xs);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .account-header p {
      color: var(--color-gray-600);
      font-size: var(--font-size-sm);
    }

    .account-grid {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: var(--spacing-xl);
    }

    .account-sidebar {
      background: var(--color-white);
      border: var(--border);
      padding: var(--spacing-lg);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .account-nav {
      list-style: none;
    }

    .account-nav-item {
      margin-bottom: var(--spacing-sm);
    }

    .account-nav-link {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm);
      color: var(--color-black);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all var(--transition-fast);
      border-left: 3px solid transparent;
    }

    .account-nav-link:hover {
      background: #f5f5f5;
      border-left-color: var(--color-black);
    }

    .account-nav-link.active {
      background: #f5f5f5;
      border-left-color: var(--color-black);
      font-weight: var(--font-weight-bold);
    }

    .account-nav-link svg {
      width: 18px;
      height: 18px;
    }

    .account-content {
      background: var(--color-white);
      border: var(--border);
      padding: var(--spacing-lg);
      min-height: 500px;
    }

    .account-section {
      display: none;
    }

    .account-section.active {
      display: block;
    }

    .section-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--spacing-lg);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding-bottom: var(--spacing-md);
      border-bottom: var(--border);
    }

    .profile-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    .info-card {
      padding: var(--spacing-md);
      background: #fafafa;
      border: var(--border);
    }

    .info-label {
      font-size: var(--font-size-xs);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-gray-600);
      margin-bottom: var(--spacing-xs);
      font-weight: var(--font-weight-medium);
    }

    .info-value {
      font-size: var(--font-size-base);
      font-family: var(--font-mono);
      color: var(--color-black);
      font-weight: var(--font-weight-medium);
    }

    .orders-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .order-card {
      border: var(--border);
      padding: var(--spacing-md);
      transition: transform var(--transition-fast);
    }

    .order-card:hover {
      transform: translateX(4px);
      background: #fafafa;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-sm);
      border-bottom: 1px solid #e0e0e0;
    }

    .order-id {
      font-family: var(--font-mono);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
    }

    .order-date {
      font-size: var(--font-size-xs);
      color: var(--color-gray-600);
    }

    .order-status {
      display: inline-block;
      padding: 4px 12px;
      background: #FFF3CD;
      border: var(--border);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .order-status.completed {
      background: #D4EDDA;
      border-color: #28A745;
    }

    .order-status.cancelled {
      background: #F8D7DA;
      border-color: #DC3545;
    }

    .order-items {
      margin-top: var(--spacing-sm);
      font-size: var(--font-size-sm);
      color: var(--color-gray-600);
    }

    .order-total {
      margin-top: var(--spacing-sm);
      font-family: var(--font-mono);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-bold);
      text-align: right;
    }

    .logout-btn {
      width: 100%;
      padding: var(--spacing-sm);
      background: var(--color-white);
      color: var(--color-black);
      border: var(--border);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      margin-top: var(--spacing-md);
      transition: all var(--transition-fast);
    }

    .logout-btn:hover {
      background: var(--color-black);
      color: var(--color-white);
    }

    .empty-state {
      text-align: center;
      padding: var(--spacing-xl);
      color: var(--color-gray-600);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: var(--spacing-md);
      opacity: 0.3;
    }

    @media (max-width: 768px) {
      body {
        padding-top: 70px;
      }

      .account-container {
        padding: var(--spacing-md) var(--spacing-sm);
      }

      .account-header h1 {
        font-size: var(--font-size-xl);
      }

      .account-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .account-sidebar {
        position: static;
      }

      .account-nav {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-xs);
      }

      .account-nav-link {
        font-size: 0.7rem;
        padding: var(--spacing-xs);
      }

      .account-nav-link svg {
        width: 14px;
        height: 14px;
      }

      .profile-info {
        grid-template-columns: 1fr;
      }

      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--spacing-xs);
      }
    }
  </style>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="navbar-logo">
        BALLY<span>LIKE*</span>
      </a>
      
      <div class="navbar-menu" id="navbarMenu">
        <div class="navbar-actions">
          <a href="account.html" class="navbar-icon navbar-icon-active" id="accountIcon" aria-label="Account" title="Account">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>
          <a href="wishlist.html" class="navbar-icon" aria-label="Wishlist" title="Wishlist">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="navbar-badge" id="wishlistCount">0</span>
          </a>
          <a href="cart.html" class="navbar-icon" aria-label="Cart" title="Cart">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            <span class="navbar-badge" id="cartCount">0</span>
          </a>
        </div>
        
        <a href="index.html" class="navbar-link">HOME</a>
        <a href="shop.html" class="navbar-link">SHOP</a>
        <a href="gallery.html" class="navbar-link">GALLERY</a>
        <a href="about.html" class="navbar-link">ABOUT</a>
        <a href="#contact" class="navbar-link">CONTACT</a>
      </div>
      
      <button class="navbar-toggle" id="navbarToggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <main>
    <div class="account-container">
      <div class="account-header">
        <h1>MY ACCOUNT</h1>
        <p id="userEmail">Loading...</p>
      </div>

      <div class="account-grid">
        <aside class="account-sidebar">
          <nav>
            <ul class="account-nav">
              <li class="account-nav-item">
                <a href="#" class="account-nav-link active" data-section="profile">
                  <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  Profile
                </a>
              </li>
              <li class="account-nav-item">
                <a href="#" class="account-nav-link" data-section="orders">
                  <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                  Orders
                </a>
              </li>
            </ul>
          </nav>
          <button class="logout-btn" onclick="handleLogout()">LOGOUT</button>
        </aside>

        <div class="account-content">
          <!-- Profile Section -->
          <section id="profile-section" class="account-section active">
            <h2 class="section-title">Profile Information</h2>
            <div class="profile-info" id="profileInfo">
              <div class="info-card">
                <div class="info-label">Full Name</div>
                <div class="info-value" id="userName">-</div>
              </div>
              <div class="info-card">
                <div class="info-label">Email</div>
                <div class="info-value" id="userEmailDetail">-</div>
              </div>
              <div class="info-card">
                <div class="info-label">Member Since</div>
                <div class="info-value" id="memberSince">-</div>
              </div>
              <div class="info-card">
                <div class="info-label">Total Orders</div>
                <div class="info-value" id="totalOrders">0</div>
              </div>
            </div>
          </section>

          <!-- Orders Section -->
          <section id="orders-section" class="account-section">
            <h2 class="section-title">Order History</h2>
            <div class="orders-list" id="ordersList">
              <div class="empty-state">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <p>Loading orders...</p>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer" id="contact">
    <div class="footer-content container">
      <div class="footer-section">
        <h3>BALLYLIKE*</h3>
        <p style="font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.7; margin-top: var(--spacing-md); line-height: 1.8;">
          FASHION BRAND BLENDING FAITH, URBAN CULTURE, AND ARTISTIC EXPRESSION. BASED IN HARARE, ZIMBABWE.
        </p>
        <div class="footer-social">
          <a href="https://instagram.com/ballylike_shop" class="social-icon" aria-label="Instagram" target="_blank" rel="noopener">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069z"/>
            </svg>
          </a>
          <a href="https://tiktok.com/@ballylike" class="social-icon" aria-label="TikTok" target="_blank" rel="noopener">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/>
            </svg>
          </a>
          <a href="https://facebook.com/ballylikebrand" class="social-icon" aria-label="Facebook" target="_blank" rel="noopener">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </a>
          <a href="https://wa.me/263781457106" class="social-icon" aria-label="WhatsApp" target="_blank" rel="noopener">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
            </svg>
          </a>
        </div>
      </div>
      
      <div class="footer-section">
        <h3>LINKS</h3>
        <div class="footer-links">
          <a href="index.html" class="footer-link">HOME</a>
          <a href="shop.html" class="footer-link">SHOP</a>
          <a href="gallery.html" class="footer-link">GALLERY</a>
          <a href="about.html" class="footer-link">ABOUT</a>
          <a href="#contact" class="footer-link">CONTACT</a>
        </div>
      </div>
      
      <div class="footer-section">
        <h3>SUPPORT</h3>
        <div class="footer-links">
          <a href="#" class="footer-link">SHIPPING</a>
          <a href="#" class="footer-link">RETURNS</a>
          <a href="#" class="footer-link">SIZE GUIDE</a>
          <a href="#" class="footer-link">FAQ</a>
        </div>
      </div>
      
      <div class="footer-section">
        <h3>CONTACT</h3>
        <div class="footer-links">
          <p style="font-size: var(--font-size-xs); opacity: 0.7;">
            INFO@BALLYLIKE.CO.ZW<br>
            +263 78 145 7106<br>
            +263 78 395 2546<br>
            HARARE, ZIMBABWE
          </p>
        </div>
      </div>
    </div>
    
    <div class="footer-bottom container">
      <p>Â© 2025 BALLYLIKE*. ALL RIGHTS RESERVED. | BALLYLIKE.CO.ZW</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/supabase-config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/wishlist.js"></script>
  <script src="js/nav-badges.js"></script>
  <script src="js/main.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      // Check authentication
      if (!window.authManager?.isAuthenticated()) {
        window.location.href = 'users/login.html?redirect=../account.html';
        return;
      }

      // Load user profile
      await loadUserProfile();
      
      // Load orders
      await loadUserOrders();

      // Setup navigation
      setupNavigation();
    });

    async function loadUserProfile() {
      const user = window.authManager.user;
      const email = user.email;
      const name = user.user_metadata?.full_name || email.split('@')[0];

      // Update UI
      document.getElementById('userEmail').textContent = email;
      document.getElementById('userName').textContent = name;
      document.getElementById('userEmailDetail').textContent = email;

      // Format member since date
      const createdAt = new Date(user.created_at);
      const formatted = createdAt.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long'
      });
      document.getElementById('memberSince').textContent = formatted;

      // Get order count from Supabase
      try {
        const { data: orders, error } = await window.supabaseClient
          .from('orders')
          .select('id', { count: 'exact' })
          .eq('user_id', user.id);

        if (!error && orders) {
          document.getElementById('totalOrders').textContent = orders.length;
        }
      } catch (err) {
        console.error('Error loading order count:', err);
      }
    }

    async function loadUserOrders() {
      const ordersList = document.getElementById('ordersList');
      const user = window.authManager.user;

      try {
        const { data: orders, error } = await window.supabaseClient
          .from('orders')
          .select('*')
          .eq('user_id', user.id)
          .order('created_at', { ascending: false });

        if (error) throw error;

        if (!orders || orders.length === 0) {
          ordersList.innerHTML = `
            <div class="empty-state">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
              <p>No orders yet</p>
              <a href="shop.html" class="btn btn-primary" style="margin-top: var(--spacing-md);">START SHOPPING</a>
            </div>
          `;
          return;
        }

        ordersList.innerHTML = orders.map(order => {
          const date = new Date(order.created_at).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });

          const items = order.order_items || [];
          const itemCount = items.reduce((sum, item) => sum + item.quantity, 0);
          
          let statusClass = '';
          if (order.status === 'completed') statusClass = 'completed';
          if (order.status === 'cancelled') statusClass = 'cancelled';

          return `
            <div class="order-card">
              <div class="order-header">
                <div>
                  <div class="order-id">ORDER #${order.id.substring(0, 8).toUpperCase()}</div>
                  <div class="order-date">${date}</div>
                </div>
                <div class="order-status ${statusClass}">${order.status || 'Pending'}</div>
              </div>
              <div class="order-items">${itemCount} item${itemCount !== 1 ? 's' : ''}</div>
              <div class="order-total">Total: $${order.total.toFixed(2)}</div>
            </div>
          `;
        }).join('');

      } catch (err) {
        console.error('Error loading orders:', err);
        ordersList.innerHTML = `
          <div class="empty-state">
            <p>Error loading orders. Please try again later.</p>
          </div>
        `;
      }
    }

    function setupNavigation() {
      const navLinks = document.querySelectorAll('.account-nav-link');
      const sections = document.querySelectorAll('.account-section');

      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const sectionId = link.dataset.section;

          // Update active nav
          navLinks.forEach(l => l.classList.remove('active'));
          link.classList.add('active');

          // Show section
          sections.forEach(s => s.classList.remove('active'));
          document.getElementById(`${sectionId}-section`).classList.add('active');
        });
      });
    }

    async function handleLogout() {
      if (confirm('Are you sure you want to logout?')) {
        await window.authManager.logout();
        window.location.href = 'index.html';
      }
    }
  </script>
</body>
</html>
